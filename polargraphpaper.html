<!DOCTYPE html>
<html> <head>
<title>Polar Graphpaper generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script
src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<!--script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"
	integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
	crossorigin="anonymous" referrerpolicy="no-referrer"></script-->
<script>
  var jsPDF = window.jspdf.jsPDF;
</script>
</head>

<body>
<h1>Polar Graphpaper generator</h1>
<p>When you click 'Generate' this page will generate a two page PDF
  file containing graph paper to match your specifications. (It
  generates two pages to facilitate two-sided printing.)</p>
<form>
<label to="units">Units:</label>
<select id="units">
  <option value="mm" selected>mm</option>
  <option value="cm">cm</option>
  <option value="in">in</option>
  <option value="pt">pt</option>
</select> (tested almost exclusively with mm; all angle measurements
in degrees)
<br>    
<label to="papersize">Paper size:</label>
<select id="papersize" onchange="detectCustom()">
  <option value="0">Custom</option>
  <option value="a5">A5</option>
  <option value="a4" selected>A4</option>
  <option value="a3">A3</option>
  <option value="b5">B5</option>
  <option value="b4">B4</option>
  <option value="b3">B3</option>
  <option value="c5">C5</option>
  <option value="c4">C4</option>
  <option value="c3">C3</option>
  <option value="dl">DL</option>
  <option value="letter">US letter</option>
  <option value="legal">US legal</option>
</select>
<div style="display:none" id="customsizeDiv">
  <label to="customwidth">Width:</label>
  <input type="number" id="customwidth" size="5" value="210">
  <label to="customheight">Height:</label>
  <input type="number" id="customheight" size="5" value="297">
</div>
<div style="display:inline" id="orientDiv">
<label to="orientation">Orientation:</label><select id="orientation">
  <option value="p" selected>Portrait ▯</option>
  <option value="l">Landscape ▭</option>
</select>
</div>

<p>Margins: Enter one number (and the others blank) for all margins
equal. Enter two numbers for symmetrical (Left/Right) and (Top/Bottom)
margins. Otherwise enter L, R, T, B.</p>
<input type="number" id="m1" size="5" value="20">
<input type="number" id="m2" size="5" value="5">
<input type="number" id="m3" size="5" value="5">
<input type="number" id="m4" size="5" value="5">

<p><label to="gpph">Grids per page:</label>
<input type="number" id="gpph" size="5" value="2">
<label to="gppv">x</label><input type="number" id="gppv" size="5" value="3">
<br><label to="m5">Spacing between grids:</label><input type="number" id="m5" size="5"
value="10"><label to="m6">x</label><input type="number" id="m6" size="5" value="10">
</p>

<p>Style: We have a major spacing,
and a number of minor divisions between each major. (For example, to
have 10mm major spacing and 2mm minor spacing, set major spacing to 10
and subdivisions to 5.)
Specify radial (r) and axial (θ) 
spacing separately. For logarithmic spacing (r only), minor spacing is
adaptive.</p>
<label to="rMajor">Axial major division spacing:</label>
<input type="number" value="10" size="5" id="rMajor">
<label to="rMajorSub">Axial subdivisions:</label>
<input type="number" value="10" size="5" min="1" step="1"
       id="rMajorSub">
<input type="checkbox" id="rLog"><label to="rLog">Logarithmic</label>
<br>
<label to="hAxisWt">H Axis line weight:</label>
<input type="number" id="hAxisWt" min="0" step="0.01" value="0.25">
<input type="color" id="hAxisCol" value="#226622">
<label to="vAxisWt">V Axis line weight:</label>
<input type="number" id="vAxisWt" min="0" step="0.01" value="0.25">
<input type="color" id="vAxisCol" value="#226622">
<br>
<label to="rMajWt">Axial major line weight:</label>
<input type="number" id="rMajWt" min="0" step="0.01" value="0.15">
<input type="color" id="rMajCol" value="#44cc44">
<label to="rMinWt">minor line weight:</label>
<input type="number" id="rMinWt" min="0" step="0.01" value="0.15">
<input type="color" id="rMinCol" value="#cccccc">
<br>
<label to="thetaMajor">Radial major division spacing (degrees):</label>
<input type="number" value="15" size="5" id="thetaMajor">
<label to="thetaMajorSub">Radial subdivisions:</label>
<input type="number" value="3" size="5" min="1" step="1"
       id="thetaMajorSub">
<br>
<label to="thetaMajWt">Radial major line weight:</label>
<input type="number" id="thetaMajWt" min="0" step="0.01" value="0.15">
<input type="color" id="thetaMajCol" value="#44cc44">
<label to="vMinWt">minor line weight:</label>
<input type="number" id="thetaMinWt" min="0" step="0.01" value="0.15">
<input type="color" id="thetaMinCol" value="#cccccc">
<br>

<p><input type="button" onclick="generate()" value="Generate"></p>
</form>
<script>

  // display or hide custom paper size
  function detectCustom() {
    const customsizeDiv=document.getElementById('customsizeDiv');
    const orientDiv=document.getElementById('orientDiv');
    if(paperSize()==0) {
	customsizeDiv.style.display="inline";
	//orientDiv.style.display="none";
    }
    else {
	customsizeDiv.style.display="none";
	//orientDiv.style.display="inline";
    }
}

function paperSize() {
    return document.getElementById('papersize').value;
}

var unitconversion = {
    mm: 72/25.4,
    cm: 72/2.54,
    in: 72,
    pt: 1
}
function toUnits(x) {
    const units=document.getElementById("units").value;
    return x/unitconversion[units];
}
function createDoc() {
    const orientation=document.getElementById("orientation").value;
    const units=document.getElementById("units").value;
    var papersize=paperSize();
    if(papersize==0) {
	fmt=pageFormat();
	papersize=[fmt.w,fmt.h];
    }
    return new jsPDF({orientation: orientation, unit: units, format: papersize, putOnlyUsedFonts: true, compress: true});
}

  // Size in pt of various paper formats
  var pageFormats = {
    a0: [2383.94, 3370.39],
    a1: [1683.78, 2383.94],
    a2: [1190.55, 1683.78],
    a3: [841.89, 1190.55],
    a4: [595.28, 841.89],
    a5: [419.53, 595.28],
    a6: [297.64, 419.53],
    a7: [209.76, 297.64],
    a8: [147.4, 209.76],
    a9: [104.88, 147.4],
    a10: [73.7, 104.88],
    b0: [2834.65, 4008.19],
    b1: [2004.09, 2834.65],
    b2: [1417.32, 2004.09],
    b3: [1000.63, 1417.32],
    b4: [708.66, 1000.63],
    b5: [498.9, 708.66],
    b6: [354.33, 498.9],
    b7: [249.45, 354.33],
    b8: [175.75, 249.45],
    b9: [124.72, 175.75],
    b10: [87.87, 124.72],
    c0: [2599.37, 3676.54],
    c1: [1836.85, 2599.37],
    c2: [1298.27, 1836.85],
    c3: [918.43, 1298.27],
    c4: [649.13, 918.43],
    c5: [459.21, 649.13],
    c6: [323.15, 459.21],
    c7: [229.61, 323.15],
    c8: [161.57, 229.61],
    c9: [113.39, 161.57],
    c10: [79.37, 113.39],
    dl: [311.81, 623.62],
    letter: [612, 792],
    "government-letter": [576, 756],
    legal: [612, 1008],
    "junior-legal": [576, 360],
    ledger: [1224, 792],
    tabloid: [792, 1224],
    "credit-card": [153, 243]
  };

function _pageFormat() {
    fmt=paperSize();
    if(fmt==0) {
	const w=document.getElementById("customwidth").value;
	const h=document.getElementById("customheight").value;
	if(w>h)	return {w:parseFloat(h),h:parseFloat(w)};
	else	return {w:parseFloat(w),h:parseFloat(h)};
    }

    var f=pageFormats[fmt];
    return {w:toUnits(f[0]), h:toUnits(f[1])};
}
function pageFormat() {
    const orientation=document.getElementById("orientation").value;
    fmt=_pageFormat();
    if(orientation=='p') return fmt;
    else return {w:fmt.h, h:fmt.w};
}
function margins() {
    var m1=document.getElementById("m1").value;
    var l=parseFloat(m1);
    var r,t,b;
    var m2=document.getElementById("m2").value;
    var m3=document.getElementById("m3").value;
    var m4=document.getElementById("m4").value;
    var m5=parseFloat(document.getElementById("m5").value);
    var m6=parseFloat(document.getElementById("m6").value);
    if(m4=='' && m3=='' && m2=='')
	r=t=b=l;
    else if(m4=='' && m3=='' && m2!='') {
	t=b=parseFloat(m2);
	r=l;
    }
    else if(m2!='' && m3!='' && m4!='') {
	r=parseFloat(m2);
	t=parseFloat(m3);
	b=parseFloat(m4);
    }
    else throw("Invalid margins.");
    return {l:l, r:r, t:t, b:b, h:m5, v:m6};
}
function getGPP()
{
    const h=document.getElementById("gpph").value;
    const v=document.getElementById("gppv").value;
    return {h:h, v:v};
}
/*
 * getGridSize()
 * Taking into account the page size, margins, number of grids per page,
 * and spacing between grids, calculate the maximum radius for each grid.
 */
function getGridSize() {
    const fmt=pageFormat();
    var mar=margins();
    const gpp=getGPP();
    const hDia=(fmt.w-mar.l-mar.r-(gpp.h-1)*mar.h)/gpp.h;
    const vDia=(fmt.h-mar.t-mar.b-(gpp.v-1)*mar.v)/gpp.v;
    const dia=hDia<vDia?hDia:vDia;
    mar.h=(gpp.h>1)?((fmt.w-mar.l-mar.r-dia*gpp.h)/(gpp.h-1)):0;
    mar.v=(gpp.v>1)?((fmt.h-mar.t-mar.b-dia*gpp.v)/(gpp.v-1)):0;
    mar.l=(gpp.h>1)?(mar.l):((fmt.w-dia)/2);
    mar.t=(gpp.v>1)?(mar.t):((fmt.h-dia)/2);
    return {r:dia/2, format: fmt, margins:mar, gpp:gpp};
}
function getSpacing() {
    const rMajor=parseFloat(document.getElementById("rMajor").value);
    const thetaMajor=parseFloat(document.getElementById("thetaMajor").value);
    const rMajorSub=parseInt(document.getElementById("rMajorSub").value);
    const thetaMajorSub=parseInt(document.getElementById("thetaMajorSub").value);
    const rLog=document.getElementById("rLog").checked;
    return {r:{major:rMajor, sub:rMajorSub, log:rLog}, theta:{major: thetaMajor, sub: thetaMajorSub}};
}
function getStyle() {
    const rMajWt=parseFloat(document.getElementById("rMajWt").value);
    const thetaMajWt=parseFloat(document.getElementById("thetaMajWt").value);
    const rMinWt=parseFloat(document.getElementById("rMinWt").value);
    const thetaMinWt=parseFloat(document.getElementById("thetaMinWt").value);
    const rMajCol=document.getElementById("rMajCol").value;
    const thetaMajCol=document.getElementById("thetaMajCol").value;
    const rMinCol=document.getElementById("rMinCol").value;
    const thetaMinCol=document.getElementById("thetaMinCol").value;
    const hAxisWt=parseFloat(document.getElementById("hAxisWt").value);
    const vAxisWt=parseFloat(document.getElementById("vAxisWt").value);
    const hAxisCol=document.getElementById("hAxisCol").value;
    const vAxisCol=document.getElementById("vAxisCol").value;
    return {r:{major:{wt:rMajWt, col:rMajCol}, minor: {wt:rMinWt, col:rMinCol}},
	    theta:{major:{wt:thetaMajWt, col:thetaMajCol}, minor: {wt:thetaMinWt, col:thetaMinCol}},
	    axis:{h:{wt:hAxisWt, col: hAxisCol},v:{wt:vAxisWt, col: vAxisCol}}
	   };
    
}
function generate() {
    const version="1.00.27";
    
    const doc = createDoc();
    const gridSize=getGridSize();
    //var fmat=gridSize.fmt;
    const margin=gridSize.margins;
    var papersize=paperSize();
    if(papersize==0) {
	papersize=[fmat.w,fmat.h];
    }
    const orient=document.getElementById('orientation').value;
    const gridSpacing=getSpacing();
    const spacing=getSpacing();
    const style=getStyle();

    // add the information in a comment
    var comm=`PDF generated by https://maths.prideaux.id.au/polargraphpaper.html version ${version} (and courtesy of the jsPDF library) `+
	`with page size ${paperSize()} (${gridSize.format.w}x${gridSize.format.h}) orientation=${orient}, margins l=${margin.l}, r=${margins.r}, `+
	`t=${margins.t}, b=${margins.b}, h=${margins.h}, v=${margins.v}; major spacing=${spacing.r.major}x${spacing.theta.major}, `+
	`subdivisions=${spacing.r.sub}x${spacing.theta.sub}, log=${spacing.r.log}, style (${style.r.major.wt} ${style.r.major.col}, `+
	`${style.r.minor.wt} ${style.r.minor.col})x(${style.theta.major.wt} ${style.theta.major.col}, ${style.theta.minor.wt} `+
	`${style.theta.minor.col}) grids of size ${gridSize.r} arrayed {$gridsize.gpp.h}x{$gridsize.gpp.v}`;
    doc.comment(comm);
    console.log(comm);



/*
 * For logarithmic spacing let the decade spacing be ten times the major division size. We subdivide this into ten semimajor divisions.
 * We subdivide the semimajor divisions into minor divisions to be as near as possible to major/sub wide while being 0.1, 0.2 or 0.5 of the semimajor
 * divisions.
 * Majors : realx = start+scale*log(x/x_0)
 * We want plotx=start+10*major when x/x_0=10 so scale=10*major
 */

    // for each of two pages
    for(p=0; p<2; p++) {
	// each horizontal grid
	for(h=0; h<gridSize.gpp.h; h++) {
	    // each vertical grid
	    for(v=0; v<gridSize.gpp.v; v++) {
		var centre={};
		centre.x=margin.l+gridSize.r+(gridSize.r*2+margin.h)*h;
		centre.y=margin.t+gridSize.r+(gridSize.r*2+margin.v)*v;
		
		// radial divisions
		// how many minor divisions fit?
		var rminor=spacing.r.major/spacing.r.sub;
		var nrminor= Math.floor(gridSize.r/rminor);
		// draw radial lines
		if(! spacing.r.log){
		    doc.setLineWidth(style.r.minor.wt);
		    doc.setDrawColor(style.r.minor.col);
		    for(r=rminor; r<gridSize.r; r+=rminor)
			doc.circle(centre.x, centre.y, r, "S");
		    doc.setLineWidth(style.r.major.wt);
		    doc.setDrawColor(style.r.major.col);
		    for(r=spacing.r.major; r<gridSize.r; r+=spacing.r.major)
			doc.circle(centre.x, centre.y, r, "S");		    
		} else { // logarithmic
		    var nrmajor, scalefactor, plotr, nextplotr, dr;
		    nrmajor= Math.floor(10*Math.log((gridSize.r)/(spacing.r.major))/Math.log(10));
		    scalefactor=10*spacing.r.major/Math.log(10);
		    // draw radial lines
		    dr=1;
		    nextplotr=0;
		    for(var r=1; nextplotr<gridSize.r; r+=dr) {
			if(r/dr>=10) dr*=10;
			plotr=nextplotr;
			if(plotr>0) {
			    doc.setLineWidth(style.r.major.wt);
			    doc.setDrawColor(style.r.major.col);
			    if(plotr<gridSize.r) doc.circle(centre.x, centre.y, plotr, "S");
			}
			// minor lines
			// ideally, the average minor spacing is rminor.
			// Between this plotr and the next the distance is
			nextplotr=scalefactor*Math.log(r+dr);
			var idealSteps=(nextplotr-plotr)/rminor;
			var minorStepSize;
			if(idealSteps>7.5) minorStepSize=dr/10;
			else if(idealSteps>3) minorStepSize=dr/5;
			else if(idealSteps>1.5) minorStepSize=dr/2;
			else minorStepSize=dr;
			console.log(`r=${r} minorStepSize=${minorStepSize}\n`);
			doc.setLineWidth(style.r.minor.wt);
			doc.setDrawColor(style.r.minor.col);
			for(var mr=r+minorStepSize; mr<r+dr; mr+=minorStepSize) {
			    plotr=scalefactor*Math.log(mr);
			    if(plotr<gridSize.r)
				doc.circle(centre.x, centre.y, plotr, "S");
			}
		    }
		}

		// axes and axial divisions
		// minor
		doc.setLineWidth(style.theta.minor.wt);
		doc.setDrawColor(style.theta.minor.col);
		var dTheta=spacing.theta.major/spacing.theta.sub;
		var minR=getMinR(dTheta, style.theta.minor.wt,rminor);
		for(theta=dTheta; theta<360; theta+=dTheta) {
		    var z=[polar(minR,theta, centre), polar(gridSize.r,theta,centre)];
		    doc.line(z[0].x, z[0].y, z[1].x,z[1].y);
		}
		// major
		doc.setLineWidth(style.theta.major.wt);
		doc.setDrawColor(style.theta.major.col);
		var minR=getMinR(spacing.theta.major, style.theta.major.wt,rminor);
		for(theta=spacing.theta.major; theta<360; theta+=spacing.theta.major) {
		    var z=[polar(minR,theta,centre), polar(gridSize.r,theta,centre)];
		    doc.line(z[0].x, z[0].y, z[1].x,z[1].y);
		}
		// axes
		doc.setLineWidth(style.axis.h.wt);
		doc.setDrawColor(style.axis.h.col);
		doc.line(centre.x-gridSize.r,centre.y,centre.x+gridSize.r,centre.y);
		doc.setLineWidth(style.axis.v.wt);
		doc.setDrawColor(style.axis.v.col);
		doc.line(centre.x, centre.y-gridSize.r,centre.x,centre.y+gridSize.r);
		

	    }
	}
	if(p==0) doc.addPage(papersize,orient);
    }
    doc.save("polarpaper.pdf");
}
function polar(r, theta,centre) {
    const th_rad=theta/180*Math.PI;
    return { x:r*Math.sin(th_rad)+centre.x, y:r*Math.cos(th_rad)+centre.y };
}
// what is the minimum radius for an axial line such that the gap between centres of adjacent lines is
// at least k times the line thickness?
function getMinR(angle, thickness, roundTo) {
    const k=2.2;
    // semi-circumference is
    const sc=180/angle*k*thickness;
    return Math.round(sc/Math.PI/roundTo)*roundTo;
}
</script>

<hr>
<address></address>
<!-- hhmts start -->Last modified: Tue Dec 27 00:49:49 AWST 2022 <!-- hhmts end -->
</body> </html>
